
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TableauSigne.tableau &#8212; Documentation TableauSigne 1.5</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/translations.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation TableauSigne 1.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Code du module</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">TableauSigne.tableau</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Code source de TableauSigne.tableau</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classe de création de tableau de signe à l&#39;aide de sympy et lxml.</span>
<span class="sd">Elle génère au choix la sortie latex ou un tableau xml à lancer dans pst+.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="k">as</span> <span class="nn">regexp</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span><span class="p">,</span> <span class="n">randint</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">sympy</span> <span class="kn">import</span> <span class="n">var</span><span class="p">,</span><span class="n">sympify</span><span class="p">,</span><span class="n">oo</span><span class="p">,</span><span class="n">sign</span><span class="p">,</span><span class="n">det</span><span class="p">,</span><span class="n">Matrix</span><span class="p">,</span><span class="n">degree</span><span class="p">,</span><span class="n">Poly</span><span class="p">,</span><span class="n">denom</span><span class="p">,</span><span class="n">numer</span><span class="p">,</span><span class="n">random_poly</span><span class="p">,</span><span class="n">solve</span><span class="p">,</span><span class="n">Eq</span><span class="p">,</span><span class="n">latex</span><span class="p">,</span><span class="n">Pow</span><span class="p">,</span><span class="n">diff</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">var</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TableauSigne"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauSigne">[docs]</a><span class="k">class</span> <span class="nc">TableauSigne</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Classe de creation du tableau de signe.</span>
<span class="sd">    Les bornes par défaut sont \pm oo réglable avec le paramètre bornes.</span>

<span class="sd">    :param string expr: expression à étudier, sous forme d&#39;un produit ou quotient; </span>
<span class="sd">      avec la syntaxe sympy.</span>
<span class="sd">    :param list bornes: liste à deux éléments pour les bornes. [-oo, oo] par défaut</span>
<span class="sd">    :param int niveau: niveau de difficulté pour générer un tableau à compléter: 1 \</span>
<span class="sd">                - juste les signes à remplir; 2 - aussi les valeurs particulières.</span>

<span class="sd">    exemple::</span>

<span class="sd">        &gt;&gt;&gt; a = TableauSigne(&#39;-1*(3*x+2)*(-5*x +4)&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b = TableauSigne(&#39;(3*x+2)**3 /(2*x - 5)**2 *(5*x+1) * -8&#39;)</span>
<span class="sd">        &gt;&gt;&gt; b.export_pst(nom=&quot;SuperTest&quot;, simplif=False, ext=&#39;pag&#39;)</span>
<span class="sd">        &gt;&gt;&gt; c = TableauSigne(&#39;(3*x+2)**3 /(2*x - 5)**2 *(5*x+1) * -8&#39;, bornes=[-1, 1])</span>
<span class="sd">        &gt;&gt;&gt; d = TableauSigne(&#39;(-4*x+4)/(-2*x+3)&#39;, bornes=[0, sympify(&#39;3/2&#39;)])</span>
<span class="sd">        &gt;&gt;&gt; e = TableauSigne(&#39;x*(2-3*x)&#39;) # bug sur x factor corrigé.</span>
<span class="sd">        &gt;&gt;&gt; f = TableauSigne(&#39;3*x+1&#39;) # expression du 1er degré prise en compte</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">,</span> <span class="n">bornes</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="n">oo</span><span class="p">,</span> <span class="n">oo</span><span class="p">],</span> <span class="n">niveau</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span> <span class="o">=</span> <span class="n">bornes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">niveau</span> <span class="o">=</span> <span class="n">niveau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">is_Mul</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">args</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fact_cst</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_Number</span><span class="p">]</span>
            <span class="c1">## facteur x seul, non traité ailleurs. en principe 1 seul résultat possible.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fact_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">]</span>
            <span class="c1">## facteurs puissance &gt;=2 -&gt; racines</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pow_plus</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="k">if</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)]</span>
            <span class="c1">## facteurs simples -&gt;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pow_simple</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_Add</span><span class="p">]</span>
            <span class="c1">## tous les facteurs positifs rammenés à puissance 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pow_positif</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pow_plus</span><span class="p">]</span> <span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pow_simple</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fact_x</span><span class="p">)</span>
            <span class="c1">## facteurs puissance négative -&gt; vi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pow_moins</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">is_Add</span> <span class="ow">and</span> <span class="p">(</span><span class="n">degree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span> 
            <span class="c1"># cas d&#39;un seul facteur de degré 1:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pow_positif</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pow_moins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">:</span>
            <span class="c1"># cas de l&#39;expression &#39;x&#39; tout court, is_Add False, mais is_Symbol True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pow_positif</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pow_moins</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">racines</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">concat</span><span class="p">,</span>
                                  <span class="p">[</span><span class="n">solve</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pow_positif</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">racines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vi</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">concat</span><span class="p">,</span>
                             <span class="p">[</span><span class="n">solve</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pow_moins</span><span class="p">)])</span> <span class="c1"># valeurs interdites</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tab</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tab_nosign</span><span class="p">(</span><span class="n">niveau</span> <span class="o">=</span> <span class="n">niveau</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_arbrepst</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_arbrepst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Création de l&#39;arbre xml, de l&#39;arbre simplifié selon le format de PST+;</span>
<span class="sd">        de l&#39;arbre xml version nosign (les +- sont remplacés par …</span>
<span class="sd">        stockés dans self.xml, self.xmlsimplif, self.xmlnosign</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Tableau&quot;</span><span class="p">)</span>
        <span class="n">root_simplif</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Tableau&quot;</span><span class="p">)</span>
        <span class="n">root_nosign</span> <span class="o">=</span>  <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;Tableau&quot;</span><span class="p">)</span>
        <span class="n">ligne</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;Lignes&quot;</span><span class="p">)</span>
        <span class="c1">#ligne.text = str(len(self.facteurs)+2)</span>
        <span class="n">ligne</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">))</span>

        <span class="n">ligne_simplif</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_simplif</span><span class="p">,</span> <span class="s2">&quot;Lignes&quot;</span><span class="p">)</span>
        <span class="n">ligne_simplif</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>

        <span class="n">ligne_nosign</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_nosign</span><span class="p">,</span> <span class="s2">&quot;Lignes&quot;</span><span class="p">)</span>
        <span class="c1">#ligne.text = str(len(self.facteurs)+2)</span>
        <span class="n">ligne_nosign</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span><span class="p">))</span>

        <span class="n">col</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&quot;Colonnes&quot;</span><span class="p">)</span>
        <span class="c1">#col.text = str(2*len(self.racines)+2*len(self.vi)+4)</span>
        <span class="n">col</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Milieu&quot;</span><span class="p">]))</span>

        <span class="n">col_simplif</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_simplif</span><span class="p">,</span> <span class="s2">&quot;Colonnes&quot;</span><span class="p">)</span>
        <span class="n">col_simplif</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">text</span>

        <span class="n">col_nosign</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_nosign</span><span class="p">,</span> <span class="s2">&quot;Colonnes&quot;</span><span class="p">)</span>
        <span class="c1">#col.text = str(2*len(self.racines)+2*len(self.vi)+4)</span>
        <span class="n">col_nosign</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Milieu&quot;</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bas&quot;</span><span class="p">,</span> <span class="s2">&quot;Milieu&quot;</span><span class="p">,</span> <span class="s2">&quot;Haut&quot;</span><span class="p">]:</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span>\
                    <span class="n">regexp</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\$&#39;</span><span class="p">,</span>
                               <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_list2pststring</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">e</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xml</span> <span class="o">=</span> <span class="n">root</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bas&quot;</span><span class="p">,</span> <span class="s2">&quot;Milieu&quot;</span><span class="p">,</span> <span class="s2">&quot;Haut&quot;</span><span class="p">]:</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_simplif</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span>\
                    <span class="n">regexp</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\$&#39;</span><span class="p">,</span>
                               <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_list2pststring</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">e</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmlsimplif</span> <span class="o">=</span> <span class="n">root_simplif</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Bas&quot;</span><span class="p">,</span> <span class="s2">&quot;Milieu&quot;</span><span class="p">,</span> <span class="s2">&quot;Haut&quot;</span><span class="p">]:</span>
                <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root_nosign</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span>\
                    <span class="n">regexp</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\$&#39;</span><span class="p">,</span>
                               <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">_list2pststring</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="n">e</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xmlnosign</span> <span class="o">=</span> <span class="n">root_nosign</span>

        
    <span class="k">def</span> <span class="nf">_list2pststring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">):</span>
        <span class="c1"># disparition du + dans le cas de latex(+oo)</span>
        <span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;#&quot;</span><span class="o">+</span><span class="p">(</span><span class="n">latex</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                                              <span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">!=</span><span class="n">oo</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;+</span><span class="se">\\</span><span class="s1">infty&#39;</span><span class="p">),</span> <span class="n">l</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_fill_ligne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tete</span><span class="p">,</span> <span class="n">facteur</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Construction de la ligne des signes concernant facteur</span>
<span class="sd">        relativement à la ligne tete.</span>

<span class="sd">        tete contient la ligne d&#39;entete du tableau.</span>
<span class="sd">        facteur est l&#39;expression dont on veut étudier le signe.</span>

<span class="sd">        On renvoie un dictionnaire avec les clés Haut Milieu Bas pour faciliter</span>
<span class="sd">        la traduction dans pst+.</span>

<span class="sd">        Le remplissage des signes est traditionnel: observer le coef dir et</span>
<span class="sd">        remplir en conséquence.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tete</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Haut&quot;</span><span class="p">:</span> <span class="n">l</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">],</span> <span class="s2">&quot;Milieu&quot;</span><span class="p">:</span> <span class="n">l</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">],</span>
               <span class="s2">&quot;Bas&quot;</span><span class="p">:</span><span class="n">l</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">]}</span>
        <span class="n">signe</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;-&quot;</span><span class="p">}</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">racines</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">vi</span> 
                <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1"># barres de positions</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">tete</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Haut&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Bas&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
        <span class="c1"># titre de la ligne</span>
        <span class="k">if</span> <span class="n">facteur</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">latex</span><span class="p">(</span> <span class="n">Pow</span><span class="p">(</span><span class="n">facteur</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                          <span class="nb">abs</span><span class="p">(</span><span class="n">facteur</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">latex</span><span class="p">(</span><span class="n">facteur</span><span class="p">)</span>

        <span class="c1">#cas d&#39;une constante</span>
        <span class="k">if</span> <span class="n">facteur</span><span class="o">.</span><span class="n">is_Number</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">sign</span><span class="p">(</span><span class="n">facteur</span><span class="p">))]</span>
        <span class="c1">#Autres: puissances paires</span>
        <span class="k">elif</span> <span class="n">facteur</span><span class="o">.</span><span class="n">is_Pow</span> <span class="ow">and</span> <span class="n">facteur</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">facteur</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">),</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># solve renvoie une liste</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i0</span> <span class="o">=</span> <span class="n">tete</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="c1"># position de la racine r du facteur</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                    <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1">#Autres à améliorer suivant puissance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">facteur</span><span class="o">.</span><span class="n">is_Pow</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">facteur</span><span class="o">.</span><span class="n">args</span>
            <span class="k">elif</span> <span class="n">facteur</span><span class="o">.</span><span class="n">is_Add</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">facteur</span><span class="p">,</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">facteur</span><span class="o">.</span><span class="n">is_Symbol</span><span class="p">:</span>
                <span class="n">f</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">facteur</span><span class="p">,</span> <span class="mi">1</span>
            <span class="c1"># position du zéro</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">Eq</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># solve renvoie une liste (peut-être vide)</span>
            <span class="c1"># signe coeff dir</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">sign</span><span class="p">(</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">i0</span> <span class="o">=</span> <span class="n">tete</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="c1"># position de la racine r du facteur</span>
                <span class="c1"># out[&quot;Bas&quot;][i0] = &quot;|&quot; déjà fait à l&#39;initialisation</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># out[&quot;Haut&quot;][i0] = &quot;|&quot;</span>
                <span class="c1"># remplissage signe</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i0</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                            <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_fill_last_ligne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tete</span><span class="p">,</span> <span class="n">nom</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Création de la dernière ligne du tableau par la règle des signes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">signe</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="s2">&quot;-&quot;</span><span class="p">}</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tete</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Haut&quot;</span><span class="p">:</span> <span class="n">l</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">],</span> <span class="s2">&quot;Milieu&quot;</span><span class="p">:</span> <span class="n">l</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">],</span>
               <span class="s2">&quot;Bas&quot;</span><span class="p">:</span><span class="n">l</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">]}</span>
        <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">text{signe de }&quot;</span><span class="o">+</span><span class="n">nom</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;vide&quot;</span><span class="p">:</span>
                <span class="c1">#récupérer les signes sauf 1ere ligne</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">signe</span><span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">))]</span>
            <span class="k">elif</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">racines</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Haut&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Bas&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span>
            <span class="k">elif</span> <span class="n">tete</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vi</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;||&quot;</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Haut&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;||&quot;</span>
                <span class="n">out</span><span class="p">[</span><span class="s2">&quot;Bas&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;||&quot;</span>
        <span class="k">return</span> <span class="n">out</span>
            
    <span class="k">def</span> <span class="nf">_create_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Création du tableau de signe disponible dans self.tab et </span>
<span class="sd">        du tableau de signe simplifié disponible dans self.tabsimplif</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># c&#39;est plus pratique pour insérer les vides</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">racines</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">vi</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>\
                     <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">values</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">tete</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">concat</span><span class="p">,</span>
                                            <span class="p">[[</span><span class="s2">&quot;vide&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span> <span class="o">=</span> <span class="p">[{</span><span class="s2">&quot;Haut&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tete</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">],</span> <span class="s2">&quot;Milieu&quot;</span><span class="p">:</span> <span class="n">tete</span><span class="p">,</span>
                     <span class="s2">&quot;Bas&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tete</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">]}]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">facteurs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fill_ligne</span><span class="p">(</span><span class="n">tete</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fill_last_ligne</span><span class="p">(</span><span class="n">tete</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabsimplif</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

    <span class="k">def</span> <span class="nf">_create_tab_nosign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">niveau</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Création d&#39;un tableau de signe où les signes, les zéros, les vi </span>
<span class="sd">        sont laissés vides pour êtres complétés. </span>

<span class="sd">        À créer après le tableau de create_tab()</span>
<span class="sd">        niveau: 1 ou 2 - 1 on enlève les signes; 2 on enlève aussi les valeurs</span>
<span class="sd">                d&#39;annulation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">niveau</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">niveau</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="c1"># recalcul de l&#39;entête en mettant des … sauf aux bords</span>
                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">racines</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">vi</span> \
                      <span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="n">r</span><span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
                <span class="n">values</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">tete</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">concat</span><span class="p">,</span> \
                                    <span class="p">[[</span><span class="s2">&quot;vide&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">dots&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>\
                                    <span class="o">+</span><span class="p">[</span><span class="s2">&quot;vide&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bornes</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;Milieu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tete</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">L</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;Milieu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;+&#39;</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                                                <span class="k">else</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">dots&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>

<div class="viewcode-block" id="TableauSigne.tab2latex"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauSigne.tab2latex">[docs]</a>    <span class="k">def</span> <span class="nf">tab2latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sortie latex du tableau de signe. </span>

<span class="sd">        Il utilise le fichier tabvar.tex comme suggéré par pstplus.</span>
<span class="sd">        </span>
<span class="sd">        :param string option: in [&#39;whole&#39;, &#39;simplif&#39;, &#39;nosign&#39;]</span>

<span class="sd">        * &#39;simplif&#39;: utiliser le tableau simplifié</span>
<span class="sd">          qui ne comporte que la 1ere et la dernière ligne.</span>
<span class="sd">        * &#39;nosign&#39;: générer le tableau avec pointillés à compléter </span>
<span class="sd">          (le niveau de difficulté 1 ou 2 a été réglé à l&#39;initialisation)</span>
<span class="sd">        * &#39;whole&#39;: tableau complet normal</span>

<span class="sd">        exemple::</span>

<span class="sd">            &gt;&gt;&gt; a = TableauSigne(&#39;-1*(3*x+2)*(-5*x +4)&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(a.tab2latex())</span>
<span class="sd">            $$\\tabvar{%</span>
<span class="sd">            \\tx{x} &amp; \\tx{-\\infty} &amp;  &amp; \\tx{- \\frac{2}{3}} &amp;  &amp; \\tx{\\frac{4}{5}} &amp;  &amp; \\tx{+\\infty}\\cr</span>
<span class="sd">            \\tx{- 3 x -2} &amp;  &amp; \\tx{+} &amp; \\txt{0} &amp; \\tx{-} &amp; \\tx{|} &amp; \\tx{-} &amp; \\cr</span>
<span class="sd">            \\tx{- 5 x + 4} &amp;  &amp; \\tx{+} &amp; \\tx{|} &amp; \\tx{+} &amp; \\txt{0} &amp; \\tx{-} &amp; \\cr</span>
<span class="sd">            \\tx{\\text{signe de }f} &amp;  &amp; \\tx{+} &amp; \\txt{0} &amp; \\tx{-} &amp; \\txt{0} &amp; \\tx{+} &amp; \\cr}$$</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># choix du tableau</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">==</span><span class="s1">&#39;simplif&#39;</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabsimplif</span>
        <span class="k">elif</span> <span class="n">option</span><span class="o">==</span><span class="s1">&#39;nosign&#39;</span><span class="p">:</span>
            <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tabnosign</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#option==&#39;whole&#39;</span>
            <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span>
        <span class="c1"># appliquer plusieurs substitution sur les éléments d&#39;une ligne</span>
        <span class="c1">#&#39;|&#39;: &#39;\\tx{|}&#39;</span>
        <span class="n">trad</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;+&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">tx{+}&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">tx{-}&#39;</span><span class="p">,</span>
                <span class="s1">&#39;|&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">trait&#39;</span><span class="p">,</span>
                <span class="s1">&#39;||&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">dbt&#39;</span><span class="p">,</span>
                <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">txt</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">dots&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">tx{</span><span class="se">\\</span><span class="s1">dots}&#39;</span><span class="p">,</span>
                <span class="s1">&#39;vide&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">}</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;$$</span><span class="se">\\</span><span class="s2">tabvar{%&quot;</span>
        <span class="c1">#traitement à part pour la 1ere ligne</span>
        <span class="n">out</span> <span class="o">+=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">tx{&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">latex</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">!=</span> <span class="n">oo</span> <span class="k">else</span> <span class="s1">&#39;+</span><span class="se">\\</span><span class="s1">infty&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>
             <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;Milieu&quot;</span><span class="p">]]</span>
        <span class="c1"># enlever les &#39;vide&#39;</span>
        <span class="n">L2</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">tx</span><span class="si">{vide}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">L</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">u</span><span class="p">,</span><span class="n">v</span><span class="p">:</span>  <span class="n">u</span> <span class="o">+</span> <span class="s2">&quot; &amp; &quot;</span> <span class="o">+</span> <span class="n">v</span> <span class="p">,</span> <span class="n">L2</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;\cr&quot;</span>

        <span class="c1">#autres lignes</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">out</span> <span class="o">+=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">L</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">tx{&quot;</span><span class="o">+</span><span class="n">l</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;}&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">trad</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                                                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="s2">&quot;Milieu&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot; &amp; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;\cr&quot;</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;}$$&quot;</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="k">def</span> <span class="nf">_create_latex_intervalle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choix</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">take</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;renvoie l&#39;intervalle au format latex</span>

<span class="sd">        choix est dans la liste [&#39;++&#39; , &#39;+0&#39;, &#39;--&#39;, &#39;-0&#39;]</span>
<span class="sd">        L est une liste de taille 2</span>
<span class="sd">        take est la liste des || ou 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="n">oo</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">left] -</span><span class="se">\\</span><span class="s1">infty;&#39;</span>
        <span class="k">elif</span> <span class="n">take</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;||&quot;</span> <span class="ow">or</span> <span class="n">choix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">left] &#39;</span><span class="o">+</span><span class="n">latex</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span><span class="c1">#ne pas prendre la borne si stt+ ou-</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">left[ &#39;</span><span class="o">+</span><span class="n">latex</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;;&#39;</span>
        <span class="k">if</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">+</span><span class="n">oo</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39;+</span><span class="se">\\</span><span class="s1">infty </span><span class="se">\\</span><span class="s1">right[&#39;</span>
        <span class="k">elif</span> <span class="n">take</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;||&quot;</span>  <span class="ow">or</span> <span class="n">choix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">latex</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">right[&#39;</span> <span class="c1"># ne pas prendre la borne</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">latex</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">right]&#39;</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_get_pm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">signe</span><span class="p">):</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Milieu&#39;</span><span class="p">]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">signe</span><span class="p">]</span>
        <span class="n">datas</span> <span class="o">=</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Milieu&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">tab</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Milieu&#39;</span><span class="p">][</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">datas</span>

<div class="viewcode-block" id="TableauSigne.get_solutions"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauSigne.get_solutions">[docs]</a>    <span class="k">def</span> <span class="nf">get_solutions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;renvoie les solutions d&#39;une inéquation au format latex</span>
<span class="sd">        </span>
<span class="sd">        choix est dans [&#39;++&#39;, &#39;+0&#39;, &#39;-\-&#39;, &#39;-0&#39;] pour signifier strictement </span>
<span class="sd">        positif ou pas</span>

<span class="sd">        :param string choix: nature de l&#39;inéquation [&#39;++&#39;, &#39;+0&#39;, &#39;-\-&#39;, &#39;-0&#39;]</span>

<span class="sd">        exemple::</span>

<span class="sd">            &gt;&gt;&gt; a = TableauSigne(&#39;-1*(3*x+2)*(-5*x +4)&#39;)</span>
<span class="sd">            &gt;&gt;&gt; print(a.get_solutions(&#39;+0&#39;))</span>
<span class="sd">            \left] -\infty;- \\frac{2}{3}\\right]\cup \left[ \\frac{4}{5};+\\infty \\right[</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">paires</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_pm</span><span class="p">(</span><span class="n">choix</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">paires</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">emptyset&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">intervs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_create_latex_intervalle</span><span class="p">(</span><span class="n">choix</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                       <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">paires</span><span class="p">]</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">cup &#39;</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="n">intervs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">intervs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">I</span></div>

<div class="viewcode-block" id="TableauSigne.export_pst"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauSigne.export_pst">[docs]</a>    <span class="k">def</span> <span class="nf">export_pst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="o">=</span><span class="s2">&quot;tableau&quot;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;pag&quot;</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;simplif&#39;</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exporter l&#39;arbre xml dans un fichier. Format pag ou pst.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nom</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">sign</span><span class="p">):</span>
            <span class="n">choix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlnosign</span>
        <span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;simplif&#39;</span><span class="p">:</span>
            <span class="n">choix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmlsimplif</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">choix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xml</span>
        <span class="c1">#choix ={True: self.xmlsimplif, False: self.xml}</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">choix</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableauSigne.export_latex"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauSigne.export_latex">[docs]</a>    <span class="k">def</span> <span class="nf">export_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="o">=</span><span class="s2">&quot;tableau&quot;</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;tex&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exporter la sortie latex dans un fichier. Format tex.</span>
<span class="sd">        </span>
<span class="sd">        :param ext: pour compatibilite avec export_pst</span>
<span class="sd">        :type ext: str in &#39;tex&#39;, &#39;pag&#39;, &#39;pst&#39;</span>
<span class="sd">        :param option: &#39;simplif&#39;, &#39;whole&#39;, &#39;nosign&#39; </span>

<span class="sd">        par défaut on laisse des +- pour mettre des … pour faire un énoncé</span>
<span class="sd">        de tableau à compléter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nom</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">tab2latex</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="n">option</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<span class="c1"># class TableauVariation(TableauSigne):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Classe de creation d&#39;un tableau de variation. Ce n&#39;est qu&#39;une heuristique,</span>
<span class="c1">#     l&#39;emplacement des flèches doit être remanié à la main dans pstplus.</span>
<span class="c1">#     Les bornes par défaut sont \pm oo réglable avec le paramètre bornes.</span>
<span class="c1"># </span>
<span class="c1">#     :param string expr: expression à étudier; avec la syntaxe sympy.</span>
<span class="c1">#     :param list bornes: liste à deux éléments pour les bornes. [-oo, oo] par défaut</span>
<span class="c1"># </span>
<span class="c1">#     exemple::</span>
<span class="c1"># </span>
<span class="c1"># </span>
<span class="c1">#         &gt;&gt;&gt; a = TableauVariation(&#39;-1*(3*x+2)*(-5*x +4)&#39;)</span>
<span class="c1">#         &gt;&gt;&gt; a.arbrepst()</span>
<span class="c1">#         &gt;&gt;&gt; print(etree.tostring(a.xml, pretty_print=True))</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1"># </span>
<span class="c1">#     def __init__(self, expr, *args):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         :type expr: string</span>
<span class="c1">#         :param expr: l&#39;expression dont on veut dresser le tableau de variation</span>
<span class="c1"># </span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         self.val = sympify(expr)</span>
<span class="c1">#         deriv = factor(self.val.diff())</span>
<span class="c1">#         TableauSigne.__init__(self, str(deriv), *args)</span>
<span class="c1"># </span>
<span class="c1">#     def _sens(self,s):</span>
<span class="c1">#         if s == &quot;+&quot;:</span>
<span class="c1">#             return &quot;/&quot;</span>
<span class="c1">#         elif s == &quot;-&quot;:</span>
<span class="c1">#             return &quot;\\&quot;</span>
<span class="c1">#         else:</span>
<span class="c1">#             return s</span>
<span class="c1"># </span>
<span class="c1">#     def _convert(self, s, i):</span>
<span class="c1">#         &quot;&quot;&quot;indique la position et le symbole / ou \ à partir d&#39;un triplet du tableau de signe</span>
<span class="c1"># </span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         try:</span>
<span class="c1">#             return {&quot;+0+&quot;: (&quot;Bas&quot;, &quot;/&quot;),</span>
<span class="c1">#                 &quot;+0-&quot;: (&quot;Milieu&quot;,&quot;/&quot;),</span>
<span class="c1">#                 &quot;-0+&quot;: (&quot;Milieu&quot;, &quot;\\&quot;),</span>
<span class="c1">#                 &quot;-0-&quot;: (&quot;Haut&quot;,&quot;\\&quot;),</span>
<span class="c1">#                 &quot;0+vide&quot;: (&quot;Milieu&quot;,&quot;f(&quot;+latex(self.tab[0][&quot;Milieu&quot;][i])+&quot;)&quot;),</span>
<span class="c1">#                 &quot;0-vide&quot;: (&quot;Milieu&quot;,&quot;f(&quot;+latex(self.tab[0][&quot;Milieu&quot;][i])+&quot;)&quot;),</span>
<span class="c1">#                 &quot;0+0&quot;: (&quot;Milieu&quot;,&quot;f(&quot;+latex(self.tab[0][&quot;Milieu&quot;][i])+&quot;)&quot;),</span>
<span class="c1">#                 &quot;0-0&quot;: (&quot;Milieu&quot;,&quot;f(&quot;+latex(self.tab[0][&quot;Milieu&quot;][i])+&quot;)&quot;),</span>
<span class="c1">#                 &quot;vide+0&quot;: (&quot;Milieu&quot;, &quot;vide&quot;),</span>
<span class="c1">#                 &quot;vide-0&quot;: (&quot;Milieu&quot;, &quot;vide&quot;)}[s]</span>
<span class="c1">#         except KeyError:</span>
<span class="c1">#             pass</span>
<span class="c1"># </span>
<span class="c1">#     def complete_tab(self):</span>
<span class="c1">#         &quot;&quot;&quot;Création du tableau de signe de f&#39; et ajout des variations de f.</span>
<span class="c1"># </span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         #self._create_tab()</span>
<span class="c1">#         signe = self.tab[-1][&quot;Milieu&quot;]</span>
<span class="c1">#         #var = {&quot;Haut&quot;: len(signe)*[&quot;vide&quot;], &quot;Milieu&quot;: map(self._sens, signe), &quot;Bas&quot;: len(signe)*[&quot;vide&quot;]}</span>
<span class="c1">#         var = {&quot;Haut&quot;: len(signe)*[&quot;vide&quot;], &quot;Milieu&quot;: len(signe)*[&quot;vide&quot;], &quot;Bas&quot;: len(signe)*[&quot;vide&quot;]}</span>
<span class="c1">#         var[&quot;Haut&quot;][0] = var[&quot;Bas&quot;][0] = &quot;&quot;</span>
<span class="c1">#         var[&quot;Milieu&quot;][0] = &quot;\\text{sens de }f&quot;</span>
<span class="c1">#         # TODO: valeurs extremales locales à configurer</span>
<span class="c1">#         for i in range(1, len(signe)-2):</span>
<span class="c1">#             position, symbole = self._convert(reduce(lambda x,y: str(x)+str(y), signe[i:i+3]), i)</span>
<span class="c1">#             var[position][i] = symbole</span>
<span class="c1">#         self.tab.append(var)</span>
<span class="c1"># </span>
<span class="c1">#     def export(self, nom=&quot;tableau&quot;):</span>
<span class="c1">#         &quot;&quot;&quot;Exporter l&#39;arbre xml dans un fichier</span>
<span class="c1"># </span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         self.complete_tab()</span>
<span class="c1">#         self.arbrepst()</span>
<span class="c1">#         #</span>
<span class="c1">#         f = nom+&quot;.pst&quot;</span>
<span class="c1">#         out = open(f, &#39;w&#39;)</span>
<span class="c1">#         out.write( etree.tostring(self.xml, pretty_print=True) )</span>
<span class="c1">#         out.close()</span>


<div class="viewcode-block" id="TableauFactory"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauFactory">[docs]</a><span class="k">class</span> <span class="nc">TableauFactory</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Génère une liste de tableaux de signe.</span>
<span class="sd">    On peut à l&#39;envie générer une liste de solutions d&#39;inéquations ...</span>

<span class="sd">    exemple::</span>

<span class="sd">      &gt;&gt;&gt; test = [&#39;(3*x+2)&#39;, &#39;(5*x+4)*(2*x+8)&#39;, &#39;(9*x-3)/(5*x-1)&#39;]</span>
<span class="sd">      &gt;&gt;&gt; t = TableauFactory(test)</span>
<span class="sd">      &gt;&gt;&gt; t.export_pst(option=&#39;whole&#39;, ext=&#39;pag&#39;)</span>
<span class="sd">      &gt;&gt;&gt; t.export_latex(option=&#39;simplif&#39;)</span>
<span class="sd">      &gt;&gt;&gt; for e in t: print(e.get_solutions(&#39;++&#39;))</span>
<span class="sd">      \\left] - \\frac{2}{3};+\\infty \\right[</span>
<span class="sd">      \\left] -\\infty;-4\\right[\\cup \\left] - \\frac{4}{5};+\\infty \\right[</span>
<span class="sd">      \\left] -\\infty;\\frac{1}{5}\\right[\\cup \\left] \\frac{1}{3};+\\infty \\right[</span>
<span class="sd">      &gt;&gt;&gt; t2 = TableauFactory([randExpr(3) for i in range(2)])</span>
<span class="sd">      &gt;&gt;&gt; for x in t2: print(latex(x.expr)+&#39;\\n&#39;+ x.tab2latex(option=&#39;simplif&#39;)+&#39;\\n&#39;)</span>
<span class="sd">      - \\frac{4 x + 1}{x \\left(- 3 x -2\\right)}</span>
<span class="sd">      $$\\tabvar{%</span>
<span class="sd">      \\tx{x} &amp; \\tx{-\\infty} &amp;  &amp; \\tx{- \\frac{2}{3}} &amp;  &amp; \\tx{- \\frac{1}{4}} &amp;  &amp; \\tx{0} &amp;  &amp; \\tx{+\\infty}\\cr</span>
<span class="sd">      \\tx{\\text{signe de }f} &amp;  &amp; \\tx{-} &amp; \\dbt &amp; \\tx{+} &amp; \\txt{0} &amp; \\tx{-} &amp; \\dbt &amp; \\tx{+} &amp; \\cr}$$</span>
<span class="sd">      3 \\frac{x}{\\left(x -3\\right) \\left(2 x -4\\right)}</span>
<span class="sd">      $$\\tabvar{%</span>
<span class="sd">      \\tx{x} &amp; \\tx{-\\infty} &amp;  &amp; \\tx{0} &amp;  &amp; \\tx{2} &amp;  &amp; \\tx{3} &amp;  &amp; \\tx{+\\infty}\\cr</span>
<span class="sd">      \\tx{\\text{signe de }f} &amp;  &amp; \\tx{-} &amp; \\txt{0} &amp; \\tx{+} &amp; \\dbt &amp; \\tx{-} &amp; \\dbt &amp; \\tx{+} &amp; \\cr}$$</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;initialisation</span>

<span class="sd">        L: liste d&#39;expressions</span>
<span class="sd">        M: liste de dictionnaires d&#39;options de même taille que L</span>
<span class="sd">         notamment on peut y mettre l&#39;option niveau</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">L</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TableauSigne</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TableauSigne</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">**</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>

<div class="viewcode-block" id="TableauFactory.export_pst"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauFactory.export_pst">[docs]</a>    <span class="k">def</span> <span class="nf">export_pst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;simplif&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;pag&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;créer les fichiers sortie au format pag/pst avec option </span>
<span class="sd">        de simplification (False par défaut)</span>

<span class="sd">        :param boolean simplif: simplifier les tableaux ou pas</span>
<span class="sd">        :param string ext: extension de la sortie pag (pdfadd) pst (pstplus)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">t</span><span class="o">.</span><span class="n">export_pst</span><span class="p">(</span><span class="n">nom</span><span class="o">=</span><span class="s2">&quot;tableau&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">option</span><span class="o">=</span><span class="n">simplif</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableauFactory.export_latex"><a class="viewcode-back" href="../../interface.html#TableauSigne.TableauFactory.export_latex">[docs]</a>    <span class="k">def</span> <span class="nf">export_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nom</span><span class="o">=</span><span class="s2">&quot;tableaux_liste&quot;</span><span class="p">,</span> <span class="n">option</span><span class="o">=</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s2">&quot;tex&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;créer la sortie latex des tableaux dans un seul fichier avec option </span>
<span class="sd">        de simplification.</span>

<span class="sd">        :param string nom: le nom de la sortie .tex</span>
<span class="sd">        :param string option: in [&#39;whole&#39;, &#39;simplif&#39;, &#39;nosign&#39;]</span>
<span class="sd">        :param string ext: extension de la sortie (pour compatibilité)</span>

<span class="sd">        * &#39;simplif&#39;: utiliser le tableau simplifié qui ne comporte que la 1ere </span>
<span class="sd">          et la dernière ligne.</span>
<span class="sd">        * &#39;nosign&#39;: générer le tableau avec pointillés à compléter (le niveau </span>
<span class="sd">          de difficulté 1 ou 2 a été réglé à l&#39;initialisation) </span>
<span class="sd">        * &#39;whole&#39;: tableau complet normal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nom</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span> <span class="n">t</span><span class="o">.</span><span class="n">tab2latex</span><span class="p">(</span><span class="n">option</span><span class="o">=</span><span class="n">option</span><span class="p">))</span>
            <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>

<span class="k">def</span> <span class="nf">_genListeCoef</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">nopower</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Constuire la liste des [ai, bi] pour générer les facteurs (ai*x +bi)&quot;&quot;&quot;</span>
    <span class="c1"># tester toutes les colinéarités 2 à 2</span>
    <span class="n">multiplicateur</span> <span class="o">=</span> <span class="mi">4</span>  
    <span class="k">if</span> <span class="n">nopower</span><span class="p">:</span>
        <span class="n">nocolin</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">while</span> <span class="ow">not</span><span class="p">(</span><span class="n">nocolin</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">vals</span><span class="p">:</span>
                <span class="n">tmpC</span> <span class="o">=</span> <span class="p">[</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))]</span>
                <span class="n">Atmp</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">tmpC</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="n">tmpC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">)]</span>
                <span class="n">Areste</span> <span class="o">=</span> <span class="p">[[</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span>
                          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))]</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">Atmp</span><span class="o">+</span><span class="n">Areste</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span>
                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
            <span class="c1"># tester toutes les colinéarités 2 à 2</span>
            <span class="n">nocolin</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="c1"># calcul de colinéarité</span>
                    <span class="k">if</span> <span class="n">det</span><span class="p">(</span><span class="n">Matrix</span><span class="p">([</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">A</span><span class="p">[</span><span class="n">j</span><span class="p">]]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">nocolin</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">tmpC</span> <span class="o">=</span> <span class="p">[</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">multiplicateur</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))]</span>
            <span class="n">Atmp</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">tmpC</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="n">tmpC</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">e</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vals</span><span class="p">)]</span>
            <span class="n">Areste</span> <span class="o">=</span> <span class="p">[[</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span> <span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span>
                      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">))]</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">Atmp</span><span class="o">+</span><span class="n">Areste</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># le 1er terme du couple est un coef directeur, doit être non nul</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">[[</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">randint</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)]</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">A</span>

<div class="viewcode-block" id="randExpr"><a class="viewcode-back" href="../../interface.html#TableauSigne.randExpr">[docs]</a><span class="k">def</span> <span class="nf">randExpr</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">denomin</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">nopower</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;créer aléatoirement une expression avec n facteurs du 1er degré à coef</span>
<span class="sd">    entiers compris entre a et b. Le placement au numérateur/dénominateur se</span>
<span class="sd">    fait aussi au hasard.</span>
<span class="sd">    Attention, si nopower est activé, il faut b-a&gt;sqrt(n).</span>

<span class="sd">    :param int n: le nombre de facteurs, 2 par défaut</span>
<span class="sd">    :param int a: borne inférieure des coefs, -5 par défaut</span>
<span class="sd">    :param int b: borne supérieure des coefs, 5 par défaut</span>
<span class="sd">    :param boolean/int denomin: autoriser des expressions au dénominateur, True par défaut</span>
<span class="sd">       on autorise un int entre 0 et n pour désigner le nombre de coefs qu &#39;on veut au dénominateur</span>
<span class="sd">    :param list vals: liste de zéros ou vi de taille &lt;= n. Biensûr, vous savez ce que vous faites, vous</span>
<span class="sd">       ne pouvez proposer plusieurs fois la même (en contradiction avec nopower)</span>

<span class="sd">    exemple::</span>

<span class="sd">      &gt;&gt;&gt; randExpr(2)</span>
<span class="sd">      (-x + 2)/(2*x + 3)</span>
<span class="sd">      &gt;&gt;&gt; randExpr(3,-15,15)</span>
<span class="sd">      (-3*x + 2)*(14*x - 10)/(5*x - 14)</span>
<span class="sd">      &gt;&gt;&gt; randExpr(5, denomin=3, vals=[-4,2,3])</span>
<span class="sd">      (-3*x - 3)*(4*x - 3)/((8 - 4*x)*(9 - 3*x)*(-4*x - 16))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ope</span> <span class="o">=</span> <span class="p">([</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">denomin</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">])</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">_genListeCoef</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">nopower</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
        
    <span class="c1">#F = [(random_poly(x, 1, a,b, polys=False), choice(ope)) for i in range(n)]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">denomin</span><span class="p">)</span><span class="o">==</span><span class="nb">bool</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">*</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">choice</span><span class="p">(</span><span class="n">ope</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">denomin</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span>
        <span class="n">OPS</span> <span class="o">=</span> <span class="n">denomin</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;/&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">denomin</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">*</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">OPS</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">A</span><span class="p">)]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">sympify</span><span class="p">(</span><span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
    <span class="c1"># sadly certains facteurs &quot;colinéaires&quot; pourraient se neutraliser</span>
    <span class="c1"># ce cas ne se produit pas si nopower est activé</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">degree</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">numer</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
                     <span class="o">+</span> <span class="n">degree</span><span class="p">(</span><span class="n">Poly</span><span class="p">(</span><span class="n">denom</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)):</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[(</span><span class="n">random_poly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">polys</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">choice</span><span class="p">(</span><span class="n">ope</span><span class="p">))</span>
             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
        <span class="c1"># besoin de sympifier pour des expressions avec fractions…</span>
        <span class="c1">#out = sympify(reduce(lambda a,b: a+b[1]+&#39;(&#39;+str(b[0])+&#39;)&#39;, F, &#39;1&#39;))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Index des modules Python"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Documentation TableauSigne 1.5</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Code du module</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">TableauSigne.tableau</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2013-, B.M. - GPL v3.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.3.1.
    </div>
  </body>
</html>